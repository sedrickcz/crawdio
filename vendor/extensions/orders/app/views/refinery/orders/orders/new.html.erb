<h1>Order</h1>


<aside class="right_menu" >
  <ul>
    <% @project_pages.each_with_index do |page,index| %>

      <li><%= link_to page.title, refinery.page_path(page), :class => "index_#{index}" %></li>
    <% end -%>
    <li><a class="faq_1" href="/#faq">FAQ</a></li>
    <li><a  class="tc_1" href="/#terms">Terms & Conditions</a></li>
  </ul>
</aside>

<div class="left_main" style="font-size: 20px;">
<h2><%= @tier.title %></h2>  

<div class="tier_left_image">
  <%= image_tag @tier.image_1.url if @tier.image_1 %>
</div>

<div>
  <%= raw @tier.long_description %> 
</div>

<div class="@tier_right_image">
  <%= image_tag @tier.image_2.url if @tier.image_2 %>
</div>

<div>
  <%= number_to_currency @tier.price %>
</div>

<hr/>
<% if current_refinery_user %>


  <%= form_for [refinery, :orders, @order] do |f| %>
    <div class="field">
      <%= f.label :email %>
      <%= f.text_field :email, value: current_refinery_user.email || "" %>
    </div>
    <!-- Update pledge to higher one -->
    <% if current_refinery_user.highest_tier and current_refinery_user.highest_tier.position < @tier.position %>
      <div>
        <%= f.label :upgrade %><br/> 
        <%= f.radio_button :upgrade, 1, checked: true %> <%= t('order.upgrade', price: number_to_currency(@tier.price - current_refinery_user.highest_tier.price) ) %><br/> 
        <%= f.radio_button :upgrade, 0 %> <%= t('order.full_price') %>
      </div>
    <% elsif current_refinery_user.highest_tier and current_refinery_user.highest_tier.position >= @tier.position %>
      <%= t('order.already_have') %>
    <% end -%>

    <div class="field">
      <%= f.label :tier_id %>
      <%= f.select :tier_id, options_for_select(::Refinery::Tiers::Tier.order(:position).collect{|t| ["#{t.title} (#{number_to_currency(t.price)})", t.id]}, @tier.id) %>
    </div>

    <% if @tier.physical %>
      <div class="field">
        <%= f.label :name %>
        <%= f.text_field :name, value: current_refinery_user.name || "" %>
      </div>

      <div class="field">
        <%= f.label :street %>
        <%= f.text_field :street, value: current_refinery_user.street || "" %>
      </div>

      <div class="field">
        <%= f.label :city %>
        <%= f.text_field :city, value: current_refinery_user.city || "" %>
      </div>

      <div class="field">
        <%= f.label :country %>
        <%= f.text_field :country, value: current_refinery_user.country || "" %>
      </div>
    <% end -%>

    <% if @tier.platform_1 %>
      <div class="field">
        <%= f.label :platform_1 %>
        <%= f.select :platform_1, options_for_select(['PC','XBOX','PS4'], @order.platform_1)-%>
      </div>
    <% end -%>

    <% if @tier.platform_2 %>
      <div class="field">
        <%= f.label :platform_2 %>
        <%= f.select :platform_2, options_for_select(['PC','XBOX','PS4'], @order.platform_2)-%>
      </div>
    <% end -%>

    <% if @tier.tshirt %>
      <div class="field">
        <%= f.label :tshirt %>
        <%= f.select :tshirt, options_for_select(['XS','S','M','L','XL','XXL','XXXL'], @order.tshirt)-%>
      </div>
    <% end -%>

    <% if @tier.ingame_name %>
      <div class="field">
        <%= f.label :ingame_name %>
        <%= f.text_field :ingame_name-%>
      </div>
    <% end -%>

    <% if @tier.sword_legal %>
      <div class='field'>
        <%= f.label :sword_legal -%>
        <%= f.check_box :sword_legal -%>
      </div>
    <% end -%>

    <div class='field'>
        <%= f.label :agree -%>
        <%= f.check_box :agree -%>
      </div>
    <div class="action">
      <%= f.submit %>
    </div></div><div class="cleaner"></div>
  <% end -%>
<% end -%>